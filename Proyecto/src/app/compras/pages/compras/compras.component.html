<div class="container mx-auto p-10 bg-white flex flex-col items-center mt-6">
  <h1 class="text-2xl font-bold mb-4 font-rubik">Gestión de Compras</h1>

  <!-- Campo de búsqueda -->
  <div class="w-full max-w-6xl mb-2">
    <div class="w-1/3 relative">
      <input
        type="text"
        [(ngModel)]="searchTerm"
        (input)="filterProducts()"
        placeholder="Buscar productos..."
        class="block w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 font-rubik text-black"
      />
      <i class="fas fa-search absolute right-2 top-3 text-gray-500"></i>
    </div>
  </div>

  <!-- Tabla de productos -->
  <div *ngIf="viewMode === 'default'" class="w-full max-w-6xl">
    <table class="w-full text-sm text-left text-black shadow-md sm:rounded-lg">
      <thead class="text-xs uppercase bg-gray-50 font-bold font-rubik">
        <tr>
          <th class="px-2 py-3 text-center">Producto</th>
          <th class="px-2 py-3 text-center">Código de Barra</th>
          <th class="px-2 py-3 text-center">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let product of paginatedProducts" class="bg-white border-b">
          <td class="px-4 py-3 text-center font-medium text-black font-rubik">{{ product.title }}</td>
          <td class="px-4 py-3 text-center text-black font-rubik">{{ product.barcode || 'Sin código de barras' }}</td>
          <td class="px-4 py-3 text-center flex justify-center space-x-2">
            <button (click)="openAddLoteForm(product)" class="inline-flex items-center px-4 py-2 bg-[#31363F] text-white font-light font-rubik rounded-md shadow hover:bg-gray-700 transition duration-300 transform hover:scale-105">
              <i class="fas fa-shopping-cart mr-1"></i>
              Agregar Compra
            </button>
            <button (click)="onHistorialCompras(product)" class="px-4 py-2 bg-[#76ABAE] text-white font-light font-rubik rounded-md shadow hover:bg-[#5b9892] transition duration-300 transform hover:scale-105 ml-2">
              <i class="fas fa-calendar-alt"></i>
              Historial de Compras
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Componente de paginación -->
    <div class="flex justify-between mt-4">
      <button (click)="previousPage()" [disabled]="currentPage === 1" class="mx-2 px-4 py-2 bg-[#76ABAE] text-white rounded-md disabled:opacity-50" aria-label="Página anterior">
        Anterior
      </button>

      <button (click)="nextPage()" [disabled]="!hasMorePages()" class="mx-2 px-4 py-2 bg-[#76ABAE] text-white rounded-md disabled:opacity-50" aria-label="Siguiente página">
        Siguiente
      </button>
    </div>
  </div>

  <!-- Formulario de agregar lote -->
<div *ngIf="viewMode === 'form'" class="bg-white p-6 rounded-md shadow-md w-full max-w-6xl mx-auto mt-6">
  <h2 class="text-xl font-bold mb-4 font-rubik">Agregar Lote</h2>
  <button (click)="goBack()" class="mb-4 bg-gray-300 text-black py-1 px-2 rounded hover:bg-gray-400 transition duration-300">
    <i class="fas fa-chevron-left mr-1"></i>
    Volver
  </button>
  <form [formGroup]="loteForm" (ngSubmit)="createLote()">
    <!-- Precio de Compra -->
    <div class="mb-4">
      <label class="block text-sm font-medium text-gray-700">Precio de Compra:</label>
      <input
        formControlName="precioCompra"
        type="number"
        placeholder="Precio de compra"
        class="mt-1 block w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 font-rubik text-black shadow-sm"
      />
      <div *ngIf="loteForm.get('precioCompra')?.invalid && loteForm.get('precioCompra')?.touched" class="text-red-500 text-sm">
        <div *ngIf="loteForm.get('precioCompra')?.errors?.['required']">Este campo es obligatorio.</div>
        <div *ngIf="loteForm.get('precioCompra')?.errors?.['min']">Debe ser mayor a 0.</div>
      </div>
    </div>

    <!-- Precio de Venta -->
    <div class="mb-4">
      <label class="block text-sm font-medium text-gray-700">Precio de Venta:</label>
      <input
        formControlName="precioVenta"
        type="number"
        placeholder="Precio de venta"
        class="mt-1 block w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 font-rubik text-black shadow-sm"
      />
      <div *ngIf="loteForm.get('precioVenta')?.invalid && loteForm.get('precioVenta')?.touched" class="text-red-500 text-sm">
        <div *ngIf="loteForm.get('precioVenta')?.errors?.['required']">Este campo es obligatorio.</div>
        <div *ngIf="loteForm.get('precioVenta')?.errors?.['min']">Debe ser mayor a 0.</div>
      </div>
    </div>

    <!-- Stock -->
    <div class="mb-4">
      <label class="block text-sm font-medium text-gray-700">Stock:</label>
      <input
        formControlName="stock"
        type="number"
        placeholder="Cantidad en stock"
        class="mt-1 block w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 font-rubik text-black shadow-sm"
      />
      <div *ngIf="loteForm.get('stock')?.invalid && loteForm.get('stock')?.touched" class="text-red-500 text-sm">
        <div *ngIf="loteForm.get('stock')?.errors?.['required']">Este campo es obligatorio.</div>
        <div *ngIf="loteForm.get('stock')?.errors?.['min']">Debe ser mayor a 0.</div>
      </div>
    </div>

    <!-- Fecha de Caducidad -->
    <div class="mb-4">
      <label class="block text-sm font-medium text-gray-700">Fecha de Caducidad:</label>
      <input
        formControlName="fechaCaducidad"
        type="date"
        class="mt-1 block w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 font-rubik text-black shadow-sm"
      />
      <!-- Este campo no tiene validaciones específicas -->
    </div>

    <!-- Botón de envío -->
    <button
    type="submit"
   class="bg-[#76ABAE] text-white py-2 px-4 rounded hover:bg-[#437c80] transition duration-300 disabled:bg-gray-300 disabled:text-gray-500 disabled:cursor-not-allowed"
   [disabled]="!loteForm.valid"
    >
    <i class="fas fa-box mr-2"></i>

    Crear Lote
    </button>


  </form>
</div>



  <!-- Mensajes de alerta -->
  <div class="fixed top-14 left-1/2 transform -translate-x-1/2 m-4">
    <app-alert *ngIf="alertVisible" [message]="alertMessage" [type]="alertType"></app-alert>
  </div>

  <!-- Historial de compras -->
  <div *ngIf="viewMode === 'historial'" class="bg-white p-6 rounded-md shadow-md w-full max-w-6xl mx-auto mt-6">
  <h2 class="text-xl font-bold mb-4 font-rubik">Historial de Compras para {{ selectedProduct?.title }}</h2>
  <button (click)="goBack()" class="mb-4 bg-gray-300 text-black py-1 px-2 rounded hover:bg-gray-400 transition duration-300">
    <i class="fas fa-chevron-left mr-1"></i>
    Volver
  </button>
  <table class="w-full text-sm text-left text-black shadow-md sm:rounded-lg">
    <thead class="text-xs uppercase bg-gray-50 font-bold font-rubik">
      <tr>
        <th class="px-2 py-3 text-center">Precio de Compra</th>
        <th class="px-2 py-3 text-center">Precio de Venta</th>
        <th class="px-2 py-3 text-center">Stock</th>
        <th class="px-2 py-3 text-center">Fecha de Caducidad</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let lote of selectedLotes" class="bg-white border-b">
        <td class="px-4 py-3 text-center font-medium text-black font-rubik">{{ lote.precioCompra }}</td>
        <td class="px-4 py-3 text-center font-medium text-black font-rubik">{{ lote.precioVenta }}</td>
        <td class="px-4 py-3 text-center font-medium text-black font-rubik">{{ lote.stock }}</td>
        <td class="px-4 py-3 text-center font-medium text-black font-rubik">{{ lote.fechaCaducidad | date:'d \'de\' MMMM \'del\' y' }}</td>
      </tr>
    </tbody>
  </table>
  <div *ngIf="selectedLotes.length === 0" class="mt-4 text-gray-600 text-center font-rubik">
    No hay lotes registrados para este producto.
  </div>
  </div>

</div>
